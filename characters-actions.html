<script>
  function onDrop(type, recordlink) {
    if (type === "npcs" && isVehicle(recordlink.value)) {
      api.setValue("data.activeVehicle", [
        { ...recordlink.value, icon: "IconCarSuv" },
      ]);
    } else if (type === "abilities") {
      onDropAbility(type, recordlink);
    }
  }

  function rollInit() {
    rollInitiative(record);
  }

  function isVehicle(value) {
    return value?.data?.type === "vehicle";
  }

  function onDropAbility(type, recordLink) {
    const abilityName = recordLink.tooltip;
    const abilityObj = { ...recordLink.value, icon: "IconWand" };

    api.addValue("data.abilities", abilityObj, () => {
      const valuesToSet = {};
      api.setValues(valuesToSet);
    });
  }
</script>

<div style="display: flex; flex-direction: column; gap: 4px">
  <label size="md" variant="bold" label="Attacks" textalign="center"></label>

  <div style="width: 100%; display: flex; gap: 4px; align-items: center">
    <dropdown
      field="rangeBand"
      placeholder="Select Range Band..."
      disablediflocked="false"
      size="xs"
      label="Range to Target"
      width="fit-content"
      options='[{"label": "Engaged", "value": "Engaged"}, {"label": "Short", "value": "Short"},
        {"label": "Medium", "value": "Medium"}, {"label": "Long", "value": "Long"},
        {"label": "Extreme", "value": "Extreme"}, {"label": "Strategic", "value": "Strategic"}]'
    ></dropdown>
    <div
      style="
        margin-left: auto;
        display: flex;
        flex-direction: row;
        gap: 4px;
        align-items: flex-end;
      "
    >
      <dropdown
        field="initiativeSkill"
        label="Initiative Skill"
        size="xs"
        placeholder="Vigilance"
        disablediflocked="false"
        combo="true"
        options='[{"label": "Vigilance", "value": "Vigilance"}, {"label": "Cool", "value": "Cool"}]'
      ></dropdown>

      <button
        field="rollInitBtn"
        size="xs"
        label="Roll Initiative"
        variant="outline"
        onclick="rollInit();"
      ></button>
    </div>
  </div>

  <div
    style="display: flex; flex-direction: column; margin-top: 8px; flex-grow: 1"
  >
    <list listtype="attack_list" variant="striped" field="inventory"> </list>
  </div>
  <divider field="unarmedAttackDivider"></divider>
  <list listtype="unarmed_attack_list" field="unarmedAttack"></list>

  <label
    size="md"
    variant="bold"
    label="Active Talents"
    textalign="center"
  ></label>

  <div
    style="display: flex; flex-direction: column; margin-top: 8px; flex-grow: 1"
  >
    <list
      listtype="character_active_talent_action_list"
      variant="striped"
      field="talents"
    >
    </list>
  </div>

  <box field="specTrees" hidden="true">
    <label
      size="md"
      variant="bold"
      label="Signature Abilities"
      textalign="center"
    ></label>

    <div
      style="
        display: flex;
        flex-direction: column;
        margin-top: 8px;
        flex-grow: 1;
      "
    >
      <list
        listtype="character_specialization_action_list"
        field="specializations"
      >
      </list>
    </div>
  </box>

  <label
    size="md"
    variant="bold"
    label="Active Vehicle"
    textalign="center"
  ></label>

  <div
    style="display: flex; flex-direction: column; margin-top: 8px; flex-grow: 1"
  >
    <list
      emptylisttext="Drag a Vehicle from the NPCs Compendium to the Actions Tab"
      listtype="active_vehicle_list"
      field="activeVehicle"
    >
    </list>
  </div>

  <label size="md" variant="bold" label="Abilities" textalign="center"></label>

  <div
    style="display: flex; flex-direction: column; margin-top: 8px; flex-grow: 1"
  >
    <list listtype="character_ability_list" variant="striped" field="abilities">
    </list>
  </div>
</div>
