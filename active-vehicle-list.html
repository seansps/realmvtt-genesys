<script>
  function onChangeWounds() {
    const vehicleDataPath = getNearestParentDataPath(dataPath);
    const vehicle = api.getValue(vehicleDataPath);
    const wounds = api.getValue(`${vehicleDataPath}.data.wounds`);
    const woundThreshold = api.getValue(
      `${vehicleDataPath}.data.woundThreshold`
    );
    const woundsRemaining = Math.max(woundThreshold - wounds, 0);
    api.setValue(`${vehicleDataPath}.data.woundsRemaining`, woundsRemaining);
  }

  function onChangeStrain() {
    const vehicleDataPath = getNearestParentDataPath(dataPath);
    const vehicle = api.getValue(vehicleDataPath);
    const strain = api.getValue(`${vehicleDataPath}.data.strain`);
    const strainThreshold = api.getValue(
      `${vehicleDataPath}.data.strainThreshold`
    );
    const strainRemaining = Math.max(strainThreshold - strain, 0);
    api.setValue(`${vehicleDataPath}.data.strainRemaining`, strainRemaining);
  }
</script>

<div style="display: flex; flex-direction: column">
  <!-- Main row for icon, name, buttons -->
  <div
    style="display: flex; flex-direction: row; gap: 4px; align-items: center"
  >
    <div style="width: 30px; height: 30px; min-width: 30px; min-height: 30px">
      <portrait width="30px" height="30px" field="portrait"></portrait>
    </div>
    <div style="width: 100%">
      <namefield
        field="namefield"
        bold="true"
        variant="standard"
        placeholder="Vehicle Name..."
      ></namefield>
    </div>
  </div>

  <div
    style="
      display: flex;
      flex-direction: row;
      gap: 4px;
      flex-grow: 1;
      justify-content: center;
      flex-wrap: wrap;
    "
  >
    <numberfield
      width="60px"
      size="xs"
      field="soakValue"
      label="Armor"
      placeholder="0"
      textalign="center"
    ></numberfield>
    <numberfield
      width="80px"
      size="xs"
      color="pink"
      icon="IconHeartFilled"
      field="woundThreshold"
      onchange="onChangeWounds();"
      label="HT Threshold"
      placeholder="0"
      textalign="center"
    ></numberfield>
    <numberfield
      width="80px"
      size="xs"
      color="red"
      icon="IconHeart"
      field="wounds"
      label="Hull Trauma"
      placeholder="0"
      textalign="center"
      onchange="onChangeWounds();"
    ></numberfield>
    <numberfield
      width="80px"
      size="xs"
      color="blue"
      icon="IconActivity"
      field="strainThreshold"
      label="SS Threshold"
      placeholder="0"
      textalign="center"
      onchange="onChangeStrain();"
    ></numberfield>
    <numberfield
      width="80px"
      size="xs"
      color="cyan"
      icon="IconHeartbeat"
      field="strain"
      label="S. Strain"
      placeholder="0"
      textalign="center"
      onchange="onChangeStrain();"
    ></numberfield>
    <numberfield
      field="currentSpeed"
      maxvaluefield="speed"
      size="xs"
      label="Current Speed"
      width="80px"
      minvalue="0"
      maxvalue="100"
      textalign="center"
      placeholder="0"
    ></numberfield>
  </div>

  <divider label="Attacks"></divider>
  <list
    field="inventory"
    variant="striped"
    listtype="vehicle_attack_list"
  ></list>

  <accordion field="actionsAcc" label="Actions" size="xs">
    <list
      field="features"
      variant="striped"
      listtype="active_vehicle_action_list"
    ></list>
  </accordion>
</div>
